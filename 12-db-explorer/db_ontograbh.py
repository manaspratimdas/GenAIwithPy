import os

from langchain_experimental.graph_transformers import LLMGraphTransformer
from langchain_openai import ChatOpenAI
from db_metadata_generator import list_database_tables

from langchain_community.graphs import Neo4jGraph

llm = ChatOpenAI(temperature=0, model_name="gpt-4-turbo")

llm_transformer = LLMGraphTransformer(llm=llm)



from langchain_core.documents import Document

text = """

Table: actorTable: actor
Columns: [{'name': 'actor_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'first_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: [{'name': 'idx_actor_last_name', 'column_names': ['last_name'], 'unique': False}]
Foreign Keys: []
Table: addressTable: address
Columns: [{'name': 'address_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'address', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': False}, {'name': 'address2', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': True}, {'name': 'district', 'type': VARCHAR(length=20), 'default': None, 'comment': None, 'nullable': False}, {'name': 'city_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'postal_code', 'type': VARCHAR(length=10), 'default': None, 'comment': None, 'nullable': True}, {'name': 'phone', 'type': VARCHAR(length=20), 'default': None, 'comment': None, 'nullable': False}, {'name': 'location', 'type': NullType(), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: [{'name': 'idx_fk_city_id', 'column_names': ['city_id'], 'unique': False}, {'name': 'idx_location', 'column_names': ['location'], 'unique': False, 'type': 'SPATIAL', 'dialect_options': {'mysql_prefix': 'SPATIAL'}}]
Foreign Keys: [{'name': 'fk_address_city', 'constrained_columns': ['city_id'], 'referred_schema': None, 'referred_table': 'city', 'referred_columns': ['city_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
Table: categoryTable: category
Columns: [{'name': 'category_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'name', 'type': VARCHAR(length=25), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: []
Foreign Keys: []
Table: cityTable: city
Columns: [{'name': 'city_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'city', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': False}, {'name': 'country_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: [{'name': 'idx_fk_country_id', 'column_names': ['country_id'], 'unique': False}]
Foreign Keys: [{'name': 'fk_city_country', 'constrained_columns': ['country_id'], 'referred_schema': None, 'referred_table': 'country', 'referred_columns': ['country_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
Table: countryTable: country
Columns: [{'name': 'country_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'country', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: []
Foreign Keys: []
Table: customerTable: customer
Columns: [{'name': 'customer_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'store_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'first_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'email', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': True}, {'name': 'address_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'active', 'type': TINYINT(display_width=1), 'default': "'1'", 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'create_date', 'type': DATETIME(), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': True}]
Indexes: [{'name': 'idx_fk_address_id', 'column_names': ['address_id'], 'unique': False}, {'name': 'idx_fk_store_id', 'column_names': ['store_id'], 'unique': False}, {'name': 'idx_last_name', 'column_names': ['last_name'], 'unique': False}]
Foreign Keys: [{'name': 'fk_customer_address', 'constrained_columns': ['address_id'], 'referred_schema': None, 'referred_table': 'address', 'referred_columns': ['address_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_customer_store', 'constrained_columns': ['store_id'], 'referred_schema': None, 'referred_table': 'store', 'referred_columns': ['store_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
Table: filmTable: film
Columns: [{'name': 'film_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'title', 'type': VARCHAR(length=128), 'default': None, 'comment': None, 'nullable': False}, {'name': 'description', 'type': TEXT(), 'default': None, 'comment': None, 'nullable': True}, {'name': 'release_year', 'type': YEAR(), 'default': None, 'comment': None, 'nullable': True}, {'name': 'language_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'original_language_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': True, 'autoincrement': False}, {'name': 'rental_duration', 'type': TINYINT(unsigned=True), 'default': "'3'", 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'rental_rate', 'type': DECIMAL(precision=4, scale=2), 'default': "'4.99'", 'comment': None, 'nullable': False}, {'name': 'length', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': True, 'autoincrement': False}, {'name': 'replacement_cost', 'type': DECIMAL(precision=5, scale=2), 'default': "'19.99'", 'comment': None, 'nullable': False}, {'name': 'rating', 'type': ENUM('G', 'PG', 'PG-13', 'R', 'NC-17'), 'default': "'G'", 'comment': None, 'nullable': True}, {'name': 'special_features', 'type': SET('Trailers', 'Commentaries', 'Deleted Scenes', 'Behind the Scenes'), 'default': None, 'comment': None, 'nullable': True}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: [{'name': 'idx_fk_language_id', 'column_names': ['language_id'], 'unique': False}, {'name': 'idx_fk_original_language_id', 'column_names': ['original_language_id'], 'unique': False}, {'name': 'idx_title', 'column_names': ['title'], 'unique': False}]
Foreign Keys: [{'name': 'fk_film_language', 'constrained_columns': ['language_id'], 'referred_schema': None, 'referred_table': 'language', 'referred_columns': ['language_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_film_language_original', 'constrained_columns': ['original_language_id'], 'referred_schema': None, 'referred_table': 'language', 'referred_columns': ['language_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
Table: film_actorTable: film_actor
Columns: [{'name': 'actor_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'film_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: [{'name': 'idx_fk_film_id', 'column_names': ['film_id'], 'unique': False}]
Foreign Keys: [{'name': 'fk_film_actor_actor', 'constrained_columns': ['actor_id'], 'referred_schema': None, 'referred_table': 'actor', 'referred_columns': ['actor_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_film_actor_film', 'constrained_columns': ['film_id'], 'referred_schema': None, 'referred_table': 'film', 'referred_columns': ['film_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
Table: film_categoryTable: film_category
Columns: [{'name': 'film_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'category_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: [{'name': 'fk_film_category_category', 'column_names': ['category_id'], 'unique': False}]
Foreign Keys: [{'name': 'fk_film_category_category', 'constrained_columns': ['category_id'], 'referred_schema': None, 'referred_table': 'category', 'referred_columns': ['category_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_film_category_film', 'constrained_columns': ['film_id'], 'referred_schema': None, 'referred_table': 'film', 'referred_columns': ['film_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
Table: film_textTable: film_text
Columns: [{'name': 'film_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'title', 'type': VARCHAR(length=255), 'default': None, 'comment': None, 'nullable': False}, {'name': 'description', 'type': TEXT(), 'default': None, 'comment': None, 'nullable': True}]
Indexes: [{'name': 'idx_title_description', 'column_names': ['title', 'description'], 'unique': False, 'type': 'FULLTEXT', 'dialect_options': {'mysql_prefix': 'FULLTEXT'}}]
Foreign Keys: []
Table: inventoryTable: inventory
Columns: [{'name': 'inventory_id', 'type': MEDIUMINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'film_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'store_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: [{'name': 'idx_fk_film_id', 'column_names': ['film_id'], 'unique': False}, {'name': 'idx_store_id_film_id', 'column_names': ['store_id', 'film_id'], 'unique': False}]
Foreign Keys: [{'name': 'fk_inventory_film', 'constrained_columns': ['film_id'], 'referred_schema': None, 'referred_table': 'film', 'referred_columns': ['film_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_inventory_store', 'constrained_columns': ['store_id'], 'referred_schema': None, 'referred_table': 'store', 'referred_columns': ['store_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
Table: languageTable: language
Columns: [{'name': 'language_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'name', 'type': CHAR(length=20), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: []
Foreign Keys: []
Table: paymentTable: payment
Columns: [{'name': 'payment_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'customer_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'staff_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'rental_id', 'type': INTEGER(), 'default': None, 'comment': None, 'nullable': True, 'autoincrement': False}, {'name': 'amount', 'type': DECIMAL(precision=5, scale=2), 'default': None, 'comment': None, 'nullable': False}, {'name': 'payment_date', 'type': DATETIME(), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': True}]
Indexes: [{'name': 'fk_payment_rental', 'column_names': ['rental_id'], 'unique': False}, {'name': 'idx_fk_customer_id', 'column_names': ['customer_id'], 'unique': False}, {'name': 'idx_fk_staff_id', 'column_names': ['staff_id'], 'unique': False}]
Foreign Keys: [{'name': 'fk_payment_customer', 'constrained_columns': ['customer_id'], 'referred_schema': None, 'referred_table': 'customer', 'referred_columns': ['customer_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_payment_rental', 'constrained_columns': ['rental_id'], 'referred_schema': None, 'referred_table': 'rental', 'referred_columns': ['rental_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'SET NULL'}}, {'name': 'fk_payment_staff', 'constrained_columns': ['staff_id'], 'referred_schema': None, 'referred_table': 'staff', 'referred_columns': ['staff_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
Table: rentalTable: rental
Columns: [{'name': 'rental_id', 'type': INTEGER(), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'rental_date', 'type': DATETIME(), 'default': None, 'comment': None, 'nullable': False}, {'name': 'inventory_id', 'type': MEDIUMINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'customer_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'return_date', 'type': DATETIME(), 'default': None, 'comment': None, 'nullable': True}, {'name': 'staff_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: [{'name': 'idx_fk_customer_id', 'column_names': ['customer_id'], 'unique': False}, {'name': 'idx_fk_inventory_id', 'column_names': ['inventory_id'], 'unique': False}, {'name': 'idx_fk_staff_id', 'column_names': ['staff_id'], 'unique': False}, {'name': 'rental_date', 'column_names': ['rental_date', 'inventory_id', 'customer_id'], 'unique': True, 'type': 'UNIQUE'}]
Foreign Keys: [{'name': 'fk_rental_customer', 'constrained_columns': ['customer_id'], 'referred_schema': None, 'referred_table': 'customer', 'referred_columns': ['customer_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_rental_inventory', 'constrained_columns': ['inventory_id'], 'referred_schema': None, 'referred_table': 'inventory', 'referred_columns': ['inventory_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_rental_staff', 'constrained_columns': ['staff_id'], 'referred_schema': None, 'referred_table': 'staff', 'referred_columns': ['staff_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
Table: staffTable: staff
Columns: [{'name': 'staff_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'first_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'address_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'picture', 'type': BLOB(), 'default': None, 'comment': None, 'nullable': True}, {'name': 'email', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': True}, {'name': 'store_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'active', 'type': TINYINT(display_width=1), 'default': "'1'", 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'username', 'type': VARCHAR(length=16), 'default': None, 'comment': None, 'nullable': False}, {'name': 'password', 'type': VARCHAR(charset='utf8mb4', collation='utf8mb4_bin', length=40), 'default': None, 'comment': None, 'nullable': True}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: [{'name': 'idx_fk_address_id', 'column_names': ['address_id'], 'unique': False}, {'name': 'idx_fk_store_id', 'column_names': ['store_id'], 'unique': False}]
Foreign Keys: [{'name': 'fk_staff_address', 'constrained_columns': ['address_id'], 'referred_schema': None, 'referred_table': 'address', 'referred_columns': ['address_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_staff_store', 'constrained_columns': ['store_id'], 'referred_schema': None, 'referred_table': 'store', 'referred_columns': ['store_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
Table: storeTable: store
Columns: [{'name': 'store_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'manager_staff_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'address_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]
Indexes: [{'name': 'idx_fk_address_id', 'column_names': ['address_id'], 'unique': False}, {'name': 'idx_unique_manager', 'column_names': ['manager_staff_id'], 'unique': True, 'type': 'UNIQUE'}]
Foreign Keys: [{'name': 'fk_store_address', 'constrained_columns': ['address_id'], 'referred_schema': None, 'referred_table': 'address', 'referred_columns': ['address_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_store_staff', 'constrained_columns': ['manager_staff_id'], 'referred_schema': None, 'referred_table': 'staff', 'referred_columns': ['staff_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]
 multi_foreign_keys: {(None, 'actor'): [], (None, 'address'): [{'name': 'fk_address_city', 'constrained_columns': ['city_id'], 'referred_schema': None, 'referred_table': 'city', 'referred_columns': ['city_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}], (None, 'category'): [], (None, 'city'): [{'name': 'fk_city_country', 'constrained_columns': ['country_id'], 'referred_schema': None, 'referred_table': 'country', 'referred_columns': ['country_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}], (None, 'country'): [], (None, 'customer'): [{'name': 'fk_customer_address', 'constrained_columns': ['address_id'], 'referred_schema': None, 'referred_table': 'address', 'referred_columns': ['address_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_customer_store', 'constrained_columns': ['store_id'], 'referred_schema': None, 'referred_table': 'store', 'referred_columns': ['store_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}], (None, 'film'): [{'name': 'fk_film_language', 'constrained_columns': ['language_id'], 'referred_schema': None, 'referred_table': 'language', 'referred_columns': ['language_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_film_language_original', 'constrained_columns': ['original_language_id'], 'referred_schema': None, 'referred_table': 'language', 'referred_columns': ['language_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}], (None, 'film_actor'): [{'name': 'fk_film_actor_actor', 'constrained_columns': ['actor_id'], 'referred_schema': None, 'referred_table': 'actor', 'referred_columns': ['actor_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_film_actor_film', 'constrained_columns': ['film_id'], 'referred_schema': None, 'referred_table': 'film', 'referred_columns': ['film_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}], (None, 'film_category'): [{'name': 'fk_film_category_category', 'constrained_columns': ['category_id'], 'referred_schema': None, 'referred_table': 'category', 'referred_columns': ['category_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_film_category_film', 'constrained_columns': ['film_id'], 'referred_schema': None, 'referred_table': 'film', 'referred_columns': ['film_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}], (None, 'film_text'): [], (None, 'inventory'): [{'name': 'fk_inventory_film', 'constrained_columns': ['film_id'], 'referred_schema': None, 'referred_table': 'film', 'referred_columns': ['film_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_inventory_store', 'constrained_columns': ['store_id'], 'referred_schema': None, 'referred_table': 'store', 'referred_columns': ['store_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}], (None, 'language'): [], (None, 'payment'): [{'name': 'fk_payment_customer', 'constrained_columns': ['customer_id'], 'referred_schema': None, 'referred_table': 'customer', 'referred_columns': ['customer_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_payment_rental', 'constrained_columns': ['rental_id'], 'referred_schema': None, 'referred_table': 'rental', 'referred_columns': ['rental_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'SET NULL'}}, {'name': 'fk_payment_staff', 'constrained_columns': ['staff_id'], 'referred_schema': None, 'referred_table': 'staff', 'referred_columns': ['staff_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}], (None, 'rental'): [{'name': 'fk_rental_customer', 'constrained_columns': ['customer_id'], 'referred_schema': None, 'referred_table': 'customer', 'referred_columns': ['customer_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_rental_inventory', 'constrained_columns': ['inventory_id'], 'referred_schema': None, 'referred_table': 'inventory', 'referred_columns': ['inventory_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_rental_staff', 'constrained_columns': ['staff_id'], 'referred_schema': None, 'referred_table': 'staff', 'referred_columns': ['staff_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}], (None, 'staff'): [{'name': 'fk_staff_address', 'constrained_columns': ['address_id'], 'referred_schema': None, 'referred_table': 'address', 'referred_columns': ['address_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_staff_store', 'constrained_columns': ['store_id'], 'referred_schema': None, 'referred_table': 'store', 'referred_columns': ['store_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}], (None, 'store'): [{'name': 'fk_store_address', 'constrained_columns': ['address_id'], 'referred_schema': None, 'referred_table': 'address', 'referred_columns': ['address_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}, {'name': 'fk_store_staff', 'constrained_columns': ['manager_staff_id'], 'referred_schema': None, 'referred_table': 'staff', 'referred_columns': ['staff_id'], 'options': {'onupdate': 'CASCADE', 'ondelete': 'RESTRICT'}}]}
 multi_indexes: {(None, 'actor'): [{'name': 'idx_actor_last_name', 'column_names': ['last_name'], 'unique': False}], (None, 'address'): [{'name': 'idx_fk_city_id', 'column_names': ['city_id'], 'unique': False}, {'name': 'idx_location', 'column_names': ['location'], 'unique': False, 'type': 'SPATIAL', 'dialect_options': {'mysql_prefix': 'SPATIAL'}}], (None, 'category'): [], (None, 'city'): [{'name': 'idx_fk_country_id', 'column_names': ['country_id'], 'unique': False}], (None, 'country'): [], (None, 'customer'): [{'name': 'idx_fk_address_id', 'column_names': ['address_id'], 'unique': False}, {'name': 'idx_fk_store_id', 'column_names': ['store_id'], 'unique': False}, {'name': 'idx_last_name', 'column_names': ['last_name'], 'unique': False}], (None, 'film'): [{'name': 'idx_fk_language_id', 'column_names': ['language_id'], 'unique': False}, {'name': 'idx_fk_original_language_id', 'column_names': ['original_language_id'], 'unique': False}, {'name': 'idx_title', 'column_names': ['title'], 'unique': False}], (None, 'film_actor'): [{'name': 'idx_fk_film_id', 'column_names': ['film_id'], 'unique': False}], (None, 'film_category'): [{'name': 'fk_film_category_category', 'column_names': ['category_id'], 'unique': False}], (None, 'film_text'): [{'name': 'idx_title_description', 'column_names': ['title', 'description'], 'unique': False, 'type': 'FULLTEXT', 'dialect_options': {'mysql_prefix': 'FULLTEXT'}}], (None, 'inventory'): [{'name': 'idx_fk_film_id', 'column_names': ['film_id'], 'unique': False}, {'name': 'idx_store_id_film_id', 'column_names': ['store_id', 'film_id'], 'unique': False}], (None, 'language'): [], (None, 'payment'): [{'name': 'fk_payment_rental', 'column_names': ['rental_id'], 'unique': False}, {'name': 'idx_fk_customer_id', 'column_names': ['customer_id'], 'unique': False}, {'name': 'idx_fk_staff_id', 'column_names': ['staff_id'], 'unique': False}], (None, 'rental'): [{'name': 'idx_fk_customer_id', 'column_names': ['customer_id'], 'unique': False}, {'name': 'idx_fk_inventory_id', 'column_names': ['inventory_id'], 'unique': False}, {'name': 'idx_fk_staff_id', 'column_names': ['staff_id'], 'unique': False}, {'name': 'rental_date', 'column_names': ['rental_date', 'inventory_id', 'customer_id'], 'unique': True, 'type': 'UNIQUE'}], (None, 'staff'): [{'name': 'idx_fk_address_id', 'column_names': ['address_id'], 'unique': False}, {'name': 'idx_fk_store_id', 'column_names': ['store_id'], 'unique': False}], (None, 'store'): [{'name': 'idx_fk_address_id', 'column_names': ['address_id'], 'unique': False}, {'name': 'idx_unique_manager', 'column_names': ['manager_staff_id'], 'unique': True, 'type': 'UNIQUE'}]}
 multi_columns: {(None, 'actor'): [{'name': 'actor_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'first_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'address'): [{'name': 'address_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'address', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': False}, {'name': 'address2', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': True}, {'name': 'district', 'type': VARCHAR(length=20), 'default': None, 'comment': None, 'nullable': False}, {'name': 'city_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'postal_code', 'type': VARCHAR(length=10), 'default': None, 'comment': None, 'nullable': True}, {'name': 'phone', 'type': VARCHAR(length=20), 'default': None, 'comment': None, 'nullable': False}, {'name': 'location', 'type': NullType(), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'category'): [{'name': 'category_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'name', 'type': VARCHAR(length=25), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'city'): [{'name': 'city_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'city', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': False}, {'name': 'country_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'country'): [{'name': 'country_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'country', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'customer'): [{'name': 'customer_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'store_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'first_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'email', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': True}, {'name': 'address_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'active', 'type': TINYINT(display_width=1), 'default': "'1'", 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'create_date', 'type': DATETIME(), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': True}], (None, 'film'): [{'name': 'film_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'title', 'type': VARCHAR(length=128), 'default': None, 'comment': None, 'nullable': False}, {'name': 'description', 'type': TEXT(), 'default': None, 'comment': None, 'nullable': True}, {'name': 'release_year', 'type': YEAR(), 'default': None, 'comment': None, 'nullable': True}, {'name': 'language_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'original_language_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': True, 'autoincrement': False}, {'name': 'rental_duration', 'type': TINYINT(unsigned=True), 'default': "'3'", 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'rental_rate', 'type': DECIMAL(precision=4, scale=2), 'default': "'4.99'", 'comment': None, 'nullable': False}, {'name': 'length', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': True, 'autoincrement': False}, {'name': 'replacement_cost', 'type': DECIMAL(precision=5, scale=2), 'default': "'19.99'", 'comment': None, 'nullable': False}, {'name': 'rating', 'type': ENUM('G', 'PG', 'PG-13', 'R', 'NC-17'), 'default': "'G'", 'comment': None, 'nullable': True}, {'name': 'special_features', 'type': SET('Trailers', 'Commentaries', 'Deleted Scenes', 'Behind the Scenes'), 'default': None, 'comment': None, 'nullable': True}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'film_actor'): [{'name': 'actor_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'film_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'film_category'): [{'name': 'film_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'category_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'film_text'): [{'name': 'film_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'title', 'type': VARCHAR(length=255), 'default': None, 'comment': None, 'nullable': False}, {'name': 'description', 'type': TEXT(), 'default': None, 'comment': None, 'nullable': True}], (None, 'inventory'): [{'name': 'inventory_id', 'type': MEDIUMINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'film_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'store_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'language'): [{'name': 'language_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'name', 'type': CHAR(length=20), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'payment'): [{'name': 'payment_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'customer_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'staff_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'rental_id', 'type': INTEGER(), 'default': None, 'comment': None, 'nullable': True, 'autoincrement': False}, {'name': 'amount', 'type': DECIMAL(precision=5, scale=2), 'default': None, 'comment': None, 'nullable': False}, {'name': 'payment_date', 'type': DATETIME(), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': True}], (None, 'rental'): [{'name': 'rental_id', 'type': INTEGER(), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'rental_date', 'type': DATETIME(), 'default': None, 'comment': None, 'nullable': False}, {'name': 'inventory_id', 'type': MEDIUMINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'customer_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'return_date', 'type': DATETIME(), 'default': None, 'comment': None, 'nullable': True}, {'name': 'staff_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'staff'): [{'name': 'staff_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'first_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'last_name', 'type': VARCHAR(length=45), 'default': None, 'comment': None, 'nullable': False}, {'name': 'address_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'picture', 'type': BLOB(), 'default': None, 'comment': None, 'nullable': True}, {'name': 'email', 'type': VARCHAR(length=50), 'default': None, 'comment': None, 'nullable': True}, {'name': 'store_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'active', 'type': TINYINT(display_width=1), 'default': "'1'", 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'username', 'type': VARCHAR(length=16), 'default': None, 'comment': None, 'nullable': False}, {'name': 'password', 'type': VARCHAR(charset='utf8mb4', collation='utf8mb4_bin', length=40), 'default': None, 'comment': None, 'nullable': True}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}], (None, 'store'): [{'name': 'store_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': True}, {'name': 'manager_staff_id', 'type': TINYINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'address_id', 'type': SMALLINT(unsigned=True), 'default': None, 'comment': None, 'nullable': False, 'autoincrement': False}, {'name': 'last_update', 'type': TIMESTAMP(), 'default': 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', 'comment': None, 'nullable': False}]}
{'input': 'What are the primary keys in each table, and how do they relate to one another?', 'output': 'The primary keys in each table and how they relate to one another have been identified.'}
{'input': 'Are there any foreign key constraints in place, indicating relationships between different tables?', 'output': 'Yes, there are foreign key constraints in place in the database, indicating relationships between different tables.'}
{'input': 'How are entities represented in the database, and what attributes do they possess?', 'output': 'Entities in the database are represented by tables such as actor, customer, film, and staff. The attributes they possess include actor_id, first_name, last_name, last_update for actor; customer_id, store_id, first_name, last_name, email, address_id, active, create_date, last_update for customer; film_id, title, description, release_year, language_id, original_language_id, rental_duration, rental_rate, length, replacement_cost, rating, special_features, last_update for film; and staff_id, first_name, last_name, address_id, picture, email, store_id, active, username, password, last_update for staff.'}
{'input': 'Are there any junction tables present to facilitate many-to-many relationships between entities?', 'output': 'film_actor, film_category'}
{'input': 'How do the tables in the database reflect the overall business logic and requirements of the system they represent?', 'output': 'The tables in the database reflect the overall business logic and requirements through their structure and relationships, such as customer details and film information.'}
{'input': 'What are the primary keys in each table, and how do they relate to one another?', 'output': '- Primary keys:\n  - actor: actor_id\n  - address: address_id\n  - category: category_id\n  - city: city_id\n  - country: country_id\n  - customer: customer_id\n  - film: film_id\n  - film_actor: (actor_id, film_id)\n  - film_category: (film_id, category_id)\n  - inventory: inventory_id\n  - language: language_id\n  - payment: payment_id\n  - rental: rental_id\n  - staff: staff_id\n  - store: store_id\n\n- Relationships:\n  - actor_id in actor relates to actor_id in film_actor\n  - film_id in film_actor relates to film_id in film\n  - actor_id in actor relates to actor_id in film_actor\n  - film_id in film_actor relates to film_id in film\n  - film_id in film relates to film_id in film_actor\n  - category_id in category relates to category_id in film_category\n  - film_id in film_category relates to film_id in film'}

"""
tables = list_database_tables()

# Columns, Indexes

llm_transformer_filtered = LLMGraphTransformer(
    llm=llm,
    allowed_nodes=tables,
    # allowed_relationships=["NATIONALITY", "LOCATED_IN", "WORKED_AT", "SPOUSE"],
    # allowed_relationships=["COLUMNS", "INDEXES"],
)


documents = [Document(page_content=text)]
graph_documents_filtered = llm_transformer.convert_to_graph_documents(documents)
# print(f"Nodes:{graph_documents_filtered[0].nodes}")
# print(f"Relationships:{graph_documents_filtered[0].relationships}")

os.environ["NEO4J_URI"] = "bolt://localhost:7687"
os.environ["NEO4J_USERNAME"] = "neo4j"
os.environ["NEO4J_PASSWORD"] = "Ghy0781009"
graph = Neo4jGraph()
graph.add_graph_documents(graph_documents_filtered)
